# OCR 文字定位渲染说明

本文档说明前端如何解析 DeepSeek OCR 的定位标签并在原图上绘制框选。

## 标签格式
OCR 输出可能包含如下定位标签：

```
<|ref|>sub_title<|/ref|><|det|>[[219, 123, 765, 195]]<|/det|>
识别文本...
```

- `ref` 表示标签类型（如 `sub_title`、`text`）。
- `det` 为检测框坐标，当前实现支持：
  - 单框：`[[x1, y1, x2, y2]]`
  - 多框：`[[x1, y1, x2, y2], [...]]`

## 坐标解析与映射
前端按官方脚本逻辑将坐标映射到原图像素坐标：

1. **坐标顺序**
   - 采用 `x1, y1, x2, y2`（与官方 `draw_bounding_boxes` 一致）。

2. **坐标空间**
   - `0 ~ 1`：归一化坐标，按原图宽高换算。
   - `0 ~ 100`：百分比坐标，按原图宽高换算。
   - `0 ~ 1000`：DeepSeek OCR bins 坐标，按 `value / 999 * size` 换算。
   - 其他：视为像素坐标，直接使用。

## 渲染流程
1. 解析 OCR 输出中的标签与坐标。
2. 生成右侧结果列表（文本 + 标签）。
3. 在原图上叠加框选（支持多框），并支持点击联动高亮。

## 相关代码
- 入口与交互：`app.js`
- 关键函数：
  - `parseGroundingBlocks`：解析标签块
  - `parseDetBoxes`：解析单框/多框坐标
  - `normalizeBoxCoords`：坐标归一化/映射
  - `updateGroundingBoxes`：绘制框选

如需兼容不同坐标策略，可再加一个显式开关覆盖默认映射逻辑。
